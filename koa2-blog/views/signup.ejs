<%- include("header",{type:'signup'}) %>
<div class="container">
  <form class="form create" method="post">
    <div>
      <label>用户名:</label>
      <input placeholder="请输入用户名" type="text" name="name">
    </div>
    <div>
      <label>密码:</label>
      <input placeholder="请输入密码" class="repeatpass" type="password" name="password">
    </div>
    <div>
      <label>上传图像:</label>
      <input type="file" name="avator" id="avator">
      <input type="hidden" id="avatorVal">
      <img class="preview" alt="预览头像">
    </div>
    <div class="submit">注册</div>
  </form>
</div>
<script>
  $(window).keyup(e => {
    if (e.keyCode === 13) {
      $('.submit').click()
    }
    $('#avator').change(() => {  // 上传头像
      if (this.files.length != 0) {
        let file = this.files[0]
        let reader = new FileReader()
        if (!reader) {
          this.value = ''
          return
        }
        if (file.size >= 1024 * 1024 / 2) {
          fade("请上传小于512kb的图片!")
          return
        }
        reader.onload = function (e) {
          this.value = ''
          $('form .preview').attr('src', e.target.result)
          $('form .preview').fadeIn()
          $('#avatorVal').val(e.target.result)
        }
        reader.readAsDataURL(file)
      }
    })
    $('.submit').click(() => {
      if ($('input[name=name]').val().trim() == '') {
        fade('请输入用户名!')
      } else if ($('input[name=name]').val().match(/[<'">]/g)) {
        fade('请输入合法字符!')
      } else if ($('#avatorVal').val() == '') {
        fade('请上传头像!')
      }else{

      }
    })
  })
</script>
<% include footer %>